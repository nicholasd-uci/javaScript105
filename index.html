<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do List</title>
  <link rel="stylesheet" href="./scss/main.css">
</head>
​
<body>
 <h1>The Todo Application!</h1>
  <form>
    <p>
      <label for="item">item</label>
      <input type="text" name="item" id="item">
    </p>
    <p>
      <button id='addItem'>Add Item</button>
    </p>
  </form>
​
  <ul id="items"></ul>
​
  <script>
   
    // GIVEN [] as a second option
    // THEN also accept null values
    let items = JSON.parse(localStorage.getItem('items')) || []

    // Logic for creating a "ToDo Item"
    for (let i=0; i<items.length; i++) {

      // THEN create a separate li Tag for each Item
      let itemElem = document.createElement('li')
      
      // GIVEN item set it equal to items index.text
      itemElem.dataset.item = items[i].text

      // Checks item in localStorage was marked as done or not done 
      if(items[i].isDone) {
        itemElem.className = 'todo green'
      } else {
        itemElem.className = 'todo'
      }

      // Display the users Items
      itemElem.innerHTML =`
        ${items[i].text}
        <button class="delete">x</button
        `
      // GIVEN a new item
      // THEN it will be append to the end
      document.getElementById('items').append(itemElem)
    }

    //  Event Listen for 'addItem' 
    document.getElementById('addItem').addEventListener('click', event => {
      event.preventDefault()

      // User Clicks 'addItem' it will add item to itemObj
      let itemObj = {

        text: document.getElementById('item').value,
        // "isDone" key will let us mark each item as done or not. 
        // THEN use a bool value. Since item is just added to itemObj, it is not yet done. Which is why we set "isDone" to false.
        isDone: false
      }
      
      // GIVEN a new Item
      // THEN "add" it to "itemObj" 
      items.push(itemObj)

      // GIVEN localStorage.set 'item'
      // THEN it will create an array structure
      localStorage.setItem('items', JSON.stringify(items))

      //Creates a new List Item
      let itemElem = document.createElement('li')
      
      // GIVEN dataset of itemElem 
      // THEN take that value from the input id="item"
      // SET value of that input to 'item'
      itemElem.dataset.item = document.getElementById('item').value

      // .notation '.className' = "todo"
      itemElem.className = 'todo'
      
      // Setting HTML to show ITEM
      // THEN delete btn
      itemElem.innerHTML = `
        ${document.getElementById('item').value}<button class="delete">x</button>
        `
        
      // Appending 'item' to list
      document.getElementById('items').append(itemElem)
      
      // THEN clear out input field 
      document.getElementById('item').value = ''
    })
  
    // Page Event Listener
    document.addEventListener('click', event => {

      // GIVEN a click 
      // THEN event.target will "listen"
      // GIVEN click has .classList.contains 'todo'
      // THEN do "if" condition statement
      if (event.target.classList.contains('todo')) {
        // console.log(event.target.dataset.item)
        
        for (let i = 0; i < items.length; i++) {

          // GIVEN item with text
          // THEN should match event.target data
          if (items[i].text === event.target.dataset.item) {
          // GIVEN a match
          // THEN remove item from list
            items[i].isDone = !items[i].isDone
          }
        }

        localStorage.setItem('items', JSON.stringify(items))
        

        // So next in the list of things we want to happen when a li is clicked on, we want it to change color. If it was black text, change it to green. If it's green text, change it back to black. This is just a visual representation that we're adding to coordinate with the isDone status that's stored in localStorage.
        // NOTE: this color change action is NOT directly linked to the isDone status. We're simply setting it up so that the same action (click the li) that changes isDone also changes the color. The color is NOT changing as a result of a change in the isDone status. It's changing as a result of the click on the li and that same click also incidentally changes the isDone status of the item...but neither are directly related to the other.
        // So to accomplish this color change on click, we add or take away a class="green" to the li and then we can go up and define the class in the css style to set color: green. So we're checking if the li already has the class="green" if it does, we take it away. If it doesn't have the class="green", we add it.
        

        //check the list of classes associated with event.target to see IF event.target has class="green"
        if (event.target.classList.contains('green')) {
          // if it does have class="green" in its list of classes, remove that class
          event.target.classList.remove('green')
        } else {
          // if doesn't have class="green" in its list of classes, add it
          event.target.classList.add('green')
        }

        // so far with this recent section, we've been within the true part of the IF statement where we outline what to do if the detected click was on an element with the class="todo" (aka: what to do if we click an li). We've told the system to change the isDone status and change the text color when the detected click was on an element with class="todo". We are now at the end of that section. Now we move on to the else if that will outline what to do with clicks on other targets.

        // the else if states that if the click detected is on an element that contains class="delete", do the following. Remember, we marked those x buttons at the end of each li to have a class="delete". So in this section event.target is referencing that we've clicked on something with the "delete" class, which we know is those x buttons.
      } else if (event.target.classList.contains('delete')) {
      
        // parentNode has to do with how html tags are nested. The parentNode of an element would be the thing that is the next level of html that is nested around the element that we're talking about.
        // So in this case, our event.target is those x buttons. The HTML we have with the x buttons basically is `<li> ${item.value} <button class="delete">x</button> </li>`. So you can see how the <li> tags are the first thing that wraps around the <button> tags (not shown here of course is the other HTML that wraps around the <li> such as <ul> and <body>, etc). So since the <li> tags are the first thing that wraps around the <button> tags, that makes <li> the parentNode in this case.
        // So, the console.log here is saying to log the dataset of the element that is the parentNode of the event.target. So log the dataset that's assigned to the li. Which, if you recall, is just what was typed in the input field when we created that li.
        console.log(event.target.parentNode.dataset.item)

        // loop through the dataset and find that object which matches (is equal to) the dataset of the element that is the parentNode of the event.target. Since event.target is the x buttons, the parentNode of the event.target is the li. We're finding the object in the array that matches the dataset of the li that contains the x button the user clicked on.
        for(let i = 0; i < items.length; i++) {
          if(items[i].text === event.target.parentNode.dataset.item) {
            // Not sure here, but I'm guessing splice means to cut out (delete) that section from the array that's stored to localStorage??? But the exact syntax I don't understand.
            // OK, looking at Devin's comments: the loop combined with the if statement (the two lines of code immediately above this set of comments) finds the item in the array that is the parentNode of the event.target (aka: the li that contains the x button that was clicked), and based on it being at the i position w/in the array, cut out/delete everything in that i-th position of the items array.
            // Still not 100% sure what the 1 means in the syntax...maybe it's start at i position (aka: the position that matched our if criteria) of the array and only delete one piece of the array? as in, if it were a 2 instead, we'd start at i and delete i and i+1 (the item after i)??
            items.splice(i, 1)
          }
        }
       
        // Devin's comments indicate that this basically updates/refreshes what's stored in the localStorage
        localStorage.setItem('items', JSON.stringify(items))
        
        // this removes the HTML code for the <li> parentNode so that it disappears from the page. Whereas the splice command up in the loop just above here removes it from the localStorage array.
        event.target.parentNode.remove()

        
      // end of the else if section that dictates what happens when we click the item with class="delete" (aka: when we click the x buttons)
      }
        
    // end of the instructions of what to do for ANY click on the site (that global listen for click)
    })
  </script>
</body>
</html>